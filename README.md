# 🚌내돈내여 Project
![KakaoTalk_Photo_2022-10-21-14-36-15](https://user-images.githubusercontent.com/44489399/197121692-0bffac8f-eb68-4f17-8dda-cd8ff5e02e8b.jpeg)
> 광고 없이 내 돈으로 내가 여행한 추천여행코스를 공유하는 플랫폼 입니다.

----------


## 🔎 개발환경
   - Springboot 2.7.2
   - gradle 7.5
   - Security
   - OAuth2, JWT
   - AWS RDB(MySQL), EC2, S3
   - Tika

<br/>

## 🔎 주요기능

### **👍🏻 관심사 선택 &** 추천 페이지

- 회원 가입 후 사용자는 여행 관심사를 세 개까지 선택 할 수 있고, 
그 다음으로 이동하는 추천 페이지에서 사용자가 선택한 여행 관심사 태그를 기반으로 
추천 된 게시물을 볼 수 있습니다.

### 📝 **블로그 형식의 게시물 등록 페이지**

- 형식에 구애 받지 않는 자유로운 형태의 여행 후기를 공유 할 수 있도록 TOAST UI Editor를 
이용해 블로그 형식으로 게시물을 등록 할 수 있도록 페이지 구성을 하였습니다.

### **🗺️ 여행 경로 (Kakao map API)**

- 카카오 API를 사용하여 사용자가 방문했던 장소에 마커를 찍어 
출발지-도착지와 폴리라인을 이용한 여행경로를  게시글 내에 여행코스로 저장

### **🍻 나의 일정**

- 여행 전 나만의 여행 일정을 작성 하고, 일정 완료와 취소 버튼으로 진행 중인 
일정과 완료된 일정으로 나누어 관리 하며 필요 시 삭제 할 수 있습니다.

### **🎥 스토리 기능**

- 나만 보기 아까운 여행의 추억들을 영상 공유를 통해 내돈내여 회원들과 함께 나눌 수 있습니다. User 본인이 상시 삭제 가능하며, 매일 특정 시간에 자동으로 데이터베이스에서 삭제 되도록 구현했습니다.

### **🎉 알림 기능**

- Server Sent Events 기술을 이용해 사용자의 게시글에 댓글이 작성 되었을 때, ‘좋아요’가 눌렸을 때, 그리고 나의 일정이 임박 하였을 때 리마인더 알림을 서비스하고, 직접 웹 애플리케이션 내에서 알림을 열람하고 관리 할 수 있습니다.

### **👮신고 기능**

- 광고성이 배제된 진짜 여행 후기를 지향하는 내돈내여 서비스의 가치관과 부합하지 않는 
게시물들을 관리하기 위하여 사용자들이 게시물을 해당 사유에 따라 직접 신고 할 수 있도록 
신고 기능을 만들었습니다. 누적 신고 50개 이상이면 게시글이 자동 삭제 되도록 
관리하고 있습니다.
 

<br/>

--------------

## 💡ERD
![igo1](https://user-images.githubusercontent.com/44489399/197399324-f39dbc87-a6b9-476d-b44b-ac4876cbd2a4.png)

<br/><br/>
## 💡서비스 아키텍처
![그림01](https://user-images.githubusercontent.com/110470208/198345269-83cc478e-428d-4361-9262-689c274a15e5.jpg)


<br/><br/>
## 💡[API 설계](https://project-3.gitbook.io/login/)

<br/><br/>
## 💡트러블슈팅
#### 1. Entity 컬럼 글자 수 설정

      문제
      글과 이미지url를 컬럼 하나에 묶어 보낼 때 컬럼의 글자수 제한

      원인
      프론트에서 한 개의 Column에 text와 imgurl을 함께 담아 JSON형식으로 변환해 백엔드에 보내는 방법을 사용하기로 결정했다.
      사진 1개와 글은 문제없이 들어왔으나, 사진2개 이상과 글을 담아 보내는 과정에서 에러가 발생했다.
      에러 내용은 컬럼안에 내용들을 다 담지 못한다는 오류다.

      해결
      Column 에 추가적으로 @Column(columnDefinition = "TEXT") 입력
      columnDefinition으로 기본 엔티티 속성 값을 설정할 수 있기에 단순 TEXT형식으로 오고 가도록 설정
      Content 엔티티 안에 글 내용과 이미지를 함께 불러오는 블로그 형식의 방식이었기에 지금의 TEXT 설정을 유용하게 사용하였고,
      JSON 타입으로 RDB저장에 사용할 때는 TEXT대신 JSON을 입력하여 JPA의 의존성 기능을 더 활용할 수 있겠다.

#### 2. 깃액션
      문제
      깃 액션을 이용한 자동 배포시 8081과 8082포트가 동시에 nohup으로 시작되는 순간
      ec2에 있는 인스턴스가 cpu 100%를 사용하면서 멈추는 현상
      
      원인
      ec2를 가동시키는 하드웨어 자체에 이슈가 있는 경우도 있다고하여
      기존 인스턴스를 종료 후 새로운 인스턴스를 만들어 사용해봤지만 이슈는 같았다.
      인스턴스를 실행시키는 ubuntu 자체의 문제라고 생각이 되어
      찾아본 결과 프리티어의 메모리는 1GB정도로 지급된다고 한다.
      1GB의 메모리로 8081,8082를 동시에 연다는 것이 힘들다고 생각이 됐고
      이 과정에서 인스턴스의 메모리 부족이라고 생각이 됐다.
      
      해결
      swap파일을 하나 생성해주어 hdd의 일정공간을 ram처럼 사용하게 하였다. 
      
      1. 2GB의 빈 디스크를 만들어주었다.
      $ sudo dd if=/dev/zero of=/swapfile bs=128M count=32
      2. 만든 swap파일의 권한을 생성해주었다
      $ sudo chmod 600 /swapfile
      3. 스왑파일로 설정
      $ sudo mkswap /swapfile
      4. 스왑파일을 실행
      $ sudo swapon /swapfile
      5. 인스턴스 재시작시 swap파일을 다시 기동시켜줘야하는데 이 작업을 건너뛰기 위해서
      fstab파일에 값을 추가해 인스턴스를 재시작할때 자동으로 해당 swap을 실행시켜주게 설정.
      vi /etc/fstab
      /root/swapfile swap swap auto 0 0
      
      후 처리 예정
      1.ubuntu에서 생성한 swap으로도 서버개설이 힘들다고 생각되면 t2.micro대신 t2.meduim으로 변경 예정
      2.swap 메모리 추가
      사실 이 방법은 좋지 않은 방법 같다. 메모리를 대체할수는 있지만 100%는 힘들다
      30배 정도의 차이가 나는 방법이기 때문에 최대한 1번의 방법으로 생각중. 

#### 3. DB 형상관리
      도입이유
      서비스 배포 후 데이터베이스의 수정, 삭제, 입력 등 SQL 이력을 관리하기 위함

      요구사항
      테스트 데이터가 쌓여있는 상태에서 스키마 구조를 바꿔야 하는 상황.

      해결방안
      1. 기존에 있는 테이블의 정보만 TRUNCATE를 사용하여 모두 삭제한다.
      2. flyway툴을 사용하여 해당 테이블에 컬럼을 추가하는 migration을 진행한다.

      의견 조율
      테스트 배포 상태라 table을 삭제하고 다시 생성하는게 가장 단순한 방법이지만, 실제 배포 후 DB를 변경할 수 없는 상황에서 다른 수정 사항이 생길 수 있다는 의견이 일치했다.

      의견 결정
      실제 배포시에 DB구조를 변경해야 하는 상황이 생길 수 있다고 판단하여 flyway툴을 사용하여 mygration을 하는 방법으로 결정했다.
